#include <stdio.h>
#include <stdlib.h>
#include <sys/ioctl.h>
#include <assert.h>
#include <fcntl.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>

#include "ioctl.h"
#include "sha256.h"
#include "flagio.h"
#include "../module/flag.h"

const char *alpha = "0123456789abcdef";

unsigned char extension[] = {
  0x00, 0x55, 0x4e, 0x4c, 0x4f, 0x43, 0x4b, 0x5f, 0x46, 0x4c, 0x41, 0x47,
  0x32, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x02, 0x68
};
unsigned int extension_len = 64;

unsigned char payload[] = {
  0x55, 0x4e, 0x4c, 0x4f, 0x43, 0x4b, 0x5f, 0x46, 0x4c, 0x41, 0x47, 0x31,
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0,
  0x00, 0x55, 0x4e, 0x4c, 0x4f, 0x43, 0x4b, 0x5f, 0x46, 0x4c, 0x41, 0x47,
  0x32
};
unsigned int payload_len = 61;

int main(int argc, char **argv) {

	struct sha256_state state;
	sha256_init(&state);
	sha256_update(&state, key, sizeof(key));
	sha256_update(&state, "UNLOCK_FLAG2", 12);
	unsigned char digest[32];
	sha256_final(&state, digest);

	for (int i = 0; i < 32; i++)
		printf("%02hhx", digest[i]);
	putchar('\n');
	
}
